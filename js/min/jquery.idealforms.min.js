/*--------------------------------------------------------------------------

  jq-idealforms 2.0

  * Author: Cedric Ruiz
  * License: GPL
  * Demo: http://elclanrs.github.com/jq-idealforms/

--------------------------------------------------------------------------*/(function($){"use strict";var Utils={getMaxWidth:function($elms){var maxWidth=0;return $elms.each(function(){$(this).outerWidth()>maxWidth&&(maxWidth=$(this).outerWidth())}),maxWidth},getLessVar:function(name,prop){var value=$('<p class="'+name+'"></p>').hide().appendTo("body").css(prop);return $("."+name).remove(),/^\d+/.test(value)?parseInt(value,10):value},getKeys:function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},isFunction:function(obj){return typeof obj=="function"},isRegex:function(obj){return obj instanceof RegExp}};$.fn.toCustomSelect=function(){return this.each(function(){var $select=$(this),Select=function(){var $options=$select.find("option"),$newSelect=$('<ul class="ideal-select '+$select.attr("name")+'"/>'),$menu=$('<li><span class="title">'+$options.filter(":selected").text()+"</span></li>"),items=function(){var items=[];return $options.each(function(){var $this=$(this);items.push('<li class="item" ideal-value="'+$this.val()+'">'+$this.text()+"</li>")}),items}();return $menu.append('<ul class="sub">'+items.join("")+"</ul>"),$newSelect.append($menu),{options:$options,select:$newSelect,title:$menu.find(".title"),sub:$menu.find(".sub"),items:$menu.find(".sub li")}}(),Actions={init:function(){$select.css({position:"absolute",left:"-9999px"}),Select.select.insertAfter($select),Select.sub.hide(),Select.items.eq(Select.options.filter(":selected").index()).addClass("selected")}(),noWindowScroll:function(e){(e.which===40||e.which===38||e.which===13)&&e.preventDefault()},focusHack:function(){setTimeout(function(){$select.trigger("focus")},1)},focus:function(){Select.select.addClass("focus"),$(document).on("keydown.noscroll",Actions.noWindowScroll)},blur:function(){Select.select.removeClass("open focus"),$(document).off(".noscroll")},scrollIntoView:function(dir){var $selected=Select.items.filter(".selected"),itemHeight=$selected.outerHeight(),menuHeight=Select.sub.outerHeight(),isInView=function(){var elPos=$selected.position().top+itemHeight;return dir==="down"?elPos<=menuHeight:elPos>0}();isInView||(itemHeight=dir==="down"?itemHeight:-itemHeight,Select.sub.scrollTop(Select.sub.scrollTop()+itemHeight))},scrollToItem:function(){var idx=Select.items.filter(".selected").index(),height=Select.items.outerHeight(),items=Select.items.length,allHeight=height*items,curHeight=height*(items-idx);Select.sub.scrollTop(allHeight-curHeight)},showMenu:function(){Select.sub.fadeIn("fast"),Select.select.addClass("open"),Actions.select(Select.options.filter(":selected").index()),Actions.scrollToItem()},hideMenu:function(){Select.sub.hide(),Select.select.removeClass("open")},select:function(idx){Select.items.removeClass("selected"),Select.items.eq(idx).addClass("selected")},change:function(idx){var text=Select.items.eq(idx).text();Actions.select(idx),Select.title.text(text),Select.options.eq(idx).prop("selected",!0),$select.trigger("change")},keydown:function(key){var idx=Select.items.filter(".selected").index(),keys={9:function(){Select.select.is(".menu")&&(Actions.blur(),Actions.hideMenu())},13:function(){Select.select.is(".menu")&&(Select.select.is(".open")?Actions.hideMenu():Actions.showMenu()),Actions.change(idx)},27:function(){Select.select.is(".menu")&&Actions.hideMenu()},40:function(){idx<Select.options.length-1&&(Select.select.is(".open")?Actions.select(idx+1):Actions.change(idx+1)),Actions.scrollIntoView("down")},38:function(){idx>0&&(Select.select.is(".open")?Actions.select(idx-1):Actions.change(idx-1)),Actions.scrollIntoView("up")},"default":function(){var letter=String.fromCharCode(key),selIdx=Select.items.filter(".selected").parent().index(),curIdx=Select.items.filter(function(){var re=new RegExp("^"+letter,"i");return re.test($(this).text())}).first().index();Actions.change(~curIdx?curIdx:selIdx),Actions.scrollToItem(),Actions.focusHack()}};keys[key]?keys[key]():keys["default"]()}},events={focus:Actions.focus,"blur.menu":function(){Actions.blur(),Actions.hideMenu()},"blur.list":function(){Actions.blur()},keydown:function(e){Actions.keydown(e.which)},"clickItem.menu":function(){Actions.change($(this).index()),Actions.hideMenu()},"clickItem.list":function(){Actions.change($(this).index())},"clickTitle.menu":function(){Actions.focus(),Actions.showMenu(),$select.trigger("focus")},"hideOutside.menu":function(){$select.off("blur.menu"),$(document).on("mousedown.ideal",function(evt){$(evt.target).closest(Select.select).length?Actions.focusHack():($(document).off("mousedown.ideal"),$select.on("blur.menu",events["blur.menu"]))})},"mousedown.list":function(){Actions.focusHack()}},disableEvents=function(){Select.select.removeClass("menu list"),$select.off(".menu .list"),Select.items.off(".menu .list"),Select.select.off(".menu .list"),Select.title.off(".menu .list")};Select.select.on("menu",function(){disableEvents(),Select.select.addClass("menu"),Actions.hideMenu(),$select.on({"blur.menu":events["blur.menu"],"focus.menu":events.focus,"keydown.menu":events.keydown}),Select.select.on("mousedown.menu",events["hideOutside.menu"]),Select.items.on("click.menu",events["clickItem.menu"]),Select.title.on("click.menu",events["clickTitle.menu"])}),Select.select.on("list",function(){disableEvents(),Select.select.addClass("list"),Actions.showMenu(),$select.on({"blur.list":events["blur.list"],"focus.list":events.focus,"keydown.list":events.keydown}),Select.select.on("mousedown.list",events["mousedown.list"]),Select.items.on("mousedown.list",events["clickItem.list"])}),Select.select.on("reset",function(){Actions.change(0)}),Select.select.trigger("menu")})},$.fn.toCustomRadioCheck=function(){return this.each(function(){var $this=$(this),$span=$("<span/>");$this.is(":checkbox")?$span.addClass("ideal-check"):$span.addClass("ideal-radio"),$this.is(":checked")&&$span.addClass("checked"),$span.insertAfter($this),$(this).parent("label").attr("onclick",""),$this.css({position:"absolute",left:"-9999px"}).on({change:function(){var $this=$(this);$this.trigger("focus"),$this.is(":radio")?($this.parent().siblings("label").children(".ideal-radio").removeClass("checked"),$this.is(":checked")&&$this.next(".ideal-radio").addClass("checked")):$this.is(":checked")?$span.addClass("checked"):$span.removeClass("checked")},focus:function(){$span.parent().addClass("focus")},blur:function(){$span.parent().removeClass("focus")},click:function(){$(this).trigger("focus")}})})};var Filters={number:{regex:/\d+/,error:"Must be a number."},digits:{regex:/^\d+$/,error:"Must be only digits."},name:{regex:/^[A-Za-z]{3,}$/,error:"Must be at least 3 characters long, and must only contain letters."},username:{regex:/^[a-z](?=[\w.]{3,31}$)\w*\.?\w*$/i,error:"Must be at between 4 and 32 characters long and start with a letter. You may use letters, numbers, underscores, and one dot (.)"},pass:{regex:/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/,error:"Must be at least 6 characters long, and contain at least one number, one uppercase and one lowercase letter."},strongpass:{regex:/(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/,error:"Must be at least 8 characters long and contain at least one uppercase and one lowercase letter and one number or special character."},email:{regex:/^(?:[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-zA-Z0-9-]*[a-zA-Z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/,error:"Must be a valid e-mail address. <em>(e.g. user@gmail.com)</em>"},phone:{regex:/^[2-9]\d{2}-\d{3}-\d{4}$/,error:"Must be a valid US phone number. <em>(e.g. 555-123-4567)</em>"},zip:{regex:/^\d{5}$|^\d{5}-\d{4}$/,error:"Must be a valid US zip code. <em>(e.g. 33245 or 33245-0003)</em>"},url:{regex:/^(?:(ftp|http|https):\/\/)?(?:[\w\-]+\.)+[a-z]{3,6}$/i,error:"Must be a valid URL. <em>(e.g. www.google.com)</em>"},min:{regex:function(input,value){var min=input.userOptions.data.min;return input.input.is(":checkbox, :radio")?(this.error="Check at least <strong>"+min+"</strong>",input.input.filter(":checked").length>=min):(this.error="Must be at least <strong>"+min+"</strong> characters long.",value.length>min-1)}},max:{regex:function(input,value){var max=input.userOptions.data.max;return this.error="<strong>"+max+"</strong> characters max.",value.length<=max}},date:{regex:function(input,value){var match=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/.exec(value),isDate=function(m,d,y){return m>0&&m<13&&y>0&&y<32768&&d>0&&d<=(new Date(y,m,0)).getDate()};return match&&isDate(match[1],match[2],match[3])},error:"Must be a valid date. <em>(e.g. mm/dd/yyyy)</em>"},exclude:{regex:function(input,value){return this.error='"'+value+'" is not available.',!~$.inArray(value,input.userOptions.data.exclude)}},equalto:{regex:function(input,value){var $equals=$(input.userOptions.data.equalto),$input=input.input,name=$equals.attr("name")||$equals.attr("id");return this.error='Must be the same value as <strong>"'+name+'"</strong>',$equals.parents(".ideal-field.invalid").length?!1:$input.val()===$equals.val()}}},Flags={noerror:function(i){i.parent().siblings(".error").hide()},noicons:function(i){i.siblings(".valid-icon, .invalid-icon").hide()},novalidicon:function(i){i.siblings(".valid-icon").hide()},noinvalidicon:function(i){i.siblings(".invalid-icon").hide()},nobg:function(i){i.parents(".ideal-field").removeClass("valid invalid")},novalidbg:function(i){i.parents(".ideal-field").removeClass("valid")},noinvalidbg:function(i){i.parents(".ideal-field").removeClass("invalid")}};$.fn.idealforms=function(ops){var o=$.extend({inputs:{},customFilters:{},customFlags:{},globalFlags:"",onSuccess:function(e){alert("Thank you...")},onFail:function(){alert("The form does not validate! Check again...")},responsiveAt:"auto",customInputs:!0},ops),$form=this,FormInputs={inputs:$form.find("input, select, textarea, :button"),labels:$form.find("label:first-child"),text:$form.find("input:not(:checkbox, :radio), textarea"),select:$form.find("select"),radiocheck:$form.find("input:radio, input:checkbox"),buttons:$form.find(":button")},UserInputs=$('[name="'+Utils.getKeys(o.inputs).join('"], [name="')+'"],'+"."+Utils.getKeys(Filters).join(", .")),LessVars={fieldWidth:Utils.getLessVar("ideal-field-width","width")},PublicMethods={isValid:function(){var $invalid=$form.find(".ideal-field").filter(function(){return $(this).data("isValid")===!1});return console.log($invalid),!$invalid.length},focusFirst:function(){return $form.find("input:first").focus(),$form},focusFirstInvalid:function(){return $form.find(".ideal-field").filter(function(){return $(this).data("isValid")===!1}).first().find("input:first").focus(),$form},reset:function(){return FormInputs.text.val(""),FormInputs.radiocheck.removeAttr("checked"),FormInputs.select.find("option").first().prop("selected",!0),$form.find(".ideal-select").trigger("reset"),FormInputs.inputs.change().blur(),this.focusFirst(),$form}},Actions={init:function(){var $error=$('<span class="error" />'),$valid=$('<i class="icon valid-icon" />'),$invalid=$("<i/>",{"class":"icon invalid-icon",click:function(){var $this=$(this);$this.siblings("label").length?$this.siblings("label:first").find("input").focus():$this.siblings("input, select, textarea").focus()}});$form.css("visibility","visible").addClass("ideal-form"),$form.children("div").addClass("ideal-wrap"),$form.attr("novalidate","novalidate"),FormInputs.inputs.attr("autocomplete","off"),FormInputs.labels.addClass("ideal-label").width(Utils.getMaxWidth(FormInputs.labels)),FormInputs.text.add(FormInputs.select).each(function(){var $this=$(this);$this.wrapAll('<span class="ideal-field"/>')}),FormInputs.radiocheck.parents(".ideal-wrap").each(function(){$(this).find("label:not(.ideal-label)").wrapAll('<span class="ideal-field ideal-radiocheck"/>')}),UserInputs.parents(".ideal-field").append($valid.add($invalid)).after($error.hide()),o.customInputs&&(FormInputs.buttons.addClass("ideal-button"),FormInputs.select.toCustomSelect(),FormInputs.radiocheck.toCustomRadioCheck()),"placeholder"in $("<input/>")[0]||FormInputs.text.each(function(){$(this).val($(this).attr("placeholder"))}).on({focus:function(){this.value===$(this).attr("placeholder")&&$(this).val("")},blur:function(){$(this).val()||$(this).val($(this).attr("placeholder"))}})}(),validate:function(input,value){var isValid=!0,error="",$input=input.input,userOptions=input.userOptions,userFilters=userOptions.filters;if(userFilters){!value&&/required/.test(userFilters)&&(error=userOptions.errors&&userOptions.errors.required?userOptions.errors.required:"This field is required.",isValid=!1);if(value){userFilters=userFilters.split(/\s/);for(var i=0,len=userFilters.length;i<len;i++){var uf=userFilters[i],theFilter=Filters[uf]||"";if(theFilter&&(Utils.isFunction(theFilter.regex)&&!theFilter.regex(input,value)||Utils.isRegex(theFilter.regex)&&!theFilter.regex.test(value))){isValid=!1,error=userOptions.errors&&userOptions.errors[uf]||theFilter.error;break}}}}return{isValid:isValid,error:error}},analyze:function(input,evt){var isRadiocheck=input.is(":checkbox, :radio"),$input=function(){return isRadiocheck?UserInputs.filter('[name="'+input.attr("name")+'"]'):UserInputs.filter(input)}(),userOptions=o.inputs[input.attr("name")]||{filters:input.attr("class")},value=function(){var iVal=input.val();if(iVal===input.attr("placeholder"))return;return isRadiocheck?userOptions&&" ":iVal}(),$field=input.parents(".ideal-field"),$error=$field.next(".error"),$invalid=function(){return isRadiocheck?input.parent().siblings(".invalid-icon"):input.siblings(".invalid-icon")}(),$valid=function(){return isRadiocheck?input.parent().siblings(".valid-icon"):input.siblings(".valid-icon")}(),test=Actions.validate({input:$input,userOptions:userOptions},value),flags=function(){var f=userOptions.flags?userOptions.flags:"";return o.globalFlags&&(f+=o.globalFlags),f.split(/\s/)}(),doFlags=function(){for(var i=0,len=flags.length,f;i<len;i++){f=flags[i];if(!Flags[f])break;Flags[f]($input)}};$field.removeClass("valid invalid").data("isValid",!0),$error.add($invalid).add($valid).hide(),value&&test.isValid&&($error.add($invalid).hide(),$field.addClass("valid").data("isValid",!0),$valid.show()),test.isValid||($invalid.show(),$field.addClass("invalid").data("isValid",!1),evt!=="blur"&&$error.html(test.error).show()),doFlags()},responsive:function(){var maxWidth=LessVars.fieldWidth+FormInputs.labels.outerWidth(),$emptyLabel=FormInputs.labels.filter(function(){return $(this).html()==="&nbsp;"}),$customSelect=FormInputs.select.next(".ideal-select");o.responsiveAt==="auto"?$form.width()<maxWidth?$form.addClass("stack"):$form.removeClass("stack"):$(window).width()<o.responsiveAt?$form.addClass("stack"):$form.removeClass("stack"),$form.is(".stack")?$emptyLabel.hide():$emptyLabel.show(),$form.is(".stack")?$customSelect.trigger("list"):$customSelect.trigger("menu")}};for(var m in PublicMethods)$form[m]=PublicMethods[m];return UserInputs.on("keyup change focus blur",function(e){Actions.analyze($(this),e.type)}).blur(),$form.submit(function(e){$form.isValid()?o.onSuccess(e):(e.preventDefault(),o.onFail(),$form.focusFirstInvalid())}),o.responsiveAt&&($(window).resize(Actions.responsive),Actions.responsive()),$.extend(!0,Filters,o.customFilters),$.extend(!0,Flags,o.customFlags),this}})(jQuery);